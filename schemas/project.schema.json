{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/slauger/hugo-gitops-pipeline/main/schemas/project.schema.json",
  "title": "Hugo GitOps Project Configuration",
  "type": "object",
  "properties": {
    "steps": {
      "type": "array",
      "description": "Build phases to run (defaults: build, lint, test)",
      "items": {
        "type": "string"
      },
      "default": ["build", "lint", "test"]
    },
    "build": {
      "type": "object",
      "description": "Build phase configuration",
      "properties": {
        "steps": {
          "type": "array",
          "description": "Commands to run during build phase",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "lint": {
      "type": "object",
      "description": "Lint phase configuration",
      "properties": {
        "steps": {
          "type": "array",
          "description": "Commands to run during lint phase",
          "items": {
            "type": "string"
          }
        },
        "htmlhint": {
          "type": "boolean",
          "description": "Enable HTMLHint validation (deprecated, use steps)",
          "default": true
        },
        "links": {
          "type": "boolean",
          "description": "Enable broken link checking (deprecated, use steps)",
          "default": false
        },
        "a11y": {
          "type": "boolean",
          "description": "Enable accessibility checks (deprecated, use steps)",
          "default": false
        }
      }
    },
    "test": {
      "type": "object",
      "description": "Test phase configuration",
      "properties": {
        "steps": {
          "type": "array",
          "description": "Commands to run during test phase",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "output": {
      "type": "string",
      "description": "Build output directory",
      "default": "public"
    },
    "hugo": {
      "type": "object",
      "description": "Hugo configuration",
      "properties": {
        "source": {
          "type": "string",
          "description": "Hugo source directory",
          "default": "hugo"
        },
        "config": {
          "type": "string",
          "description": "Hugo config file name",
          "default": "hugo.toml"
        }
      }
    },
    "copy": {
      "type": "array",
      "description": "Assets to copy before build",
      "items": {
        "type": "object",
        "properties": {
          "from": {
            "type": "string",
            "description": "Source path (file or directory)"
          },
          "to": {
            "type": "string",
            "description": "Destination directory"
          }
        },
        "required": ["from", "to"]
      }
    },
    "nginx": {
      "type": "object",
      "description": "Nginx configuration",
      "properties": {
        "config_dir": {
          "type": "string",
          "description": "Directory containing nginx config snippets",
          "default": "nginx/"
        }
      }
    },
    "environments": {
      "type": "object",
      "description": "Environment configurations",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "when": {
            "type": "string",
            "description": "Regex pattern to match against GITHUB_REF"
          },
          "environment": {
            "type": "string",
            "description": "Hugo environment name (production, staging, development)"
          },
          "baseurl": {
            "type": "string",
            "description": "Hugo baseURL for this environment"
          },
          "robots": {
            "type": "string",
            "description": "Robots meta tag value",
            "default": "index, follow"
          },
          "approval_required": {
            "type": "boolean",
            "description": "Require manual approval for deployment",
            "default": false
          },
          "gitops": {
            "type": "object",
            "description": "GitOps deployment configuration",
            "properties": {
              "repository": {
                "type": "string",
                "description": "GitOps repository (owner/repo)"
              },
              "branch": {
                "type": "string",
                "description": "Target branch",
                "default": "main"
              },
              "file": {
                "type": "string",
                "description": "Values file to update"
              }
            },
            "required": ["repository", "file"]
          }
        },
        "required": ["when"]
      }
    }
  }
}
